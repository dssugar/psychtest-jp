/**
 * Rosenberg Self-Esteem Scale (RSES) - Scoring & Configuration
 *
 * Rosenberg自尊心尺度の採点とレベル判定
 *
 * スコア範囲: 10-40点
 * - 10-14点: 非常に低い自尊心
 * - 15-19点: 低い自尊心
 * - 20-29点: 平均的な自尊心
 * - 30-34点: 高い自尊心
 * - 35-40点: 非常に高い自尊心
 *
 * @reference Rosenberg, M. (1965). Society and the adolescent self-image.
 *            Princeton, NJ: Princeton University Press.
 */

import {
  rosenbergQuestions,
  scaleOptions,
  scaleInfo,
} from "@/data/rosenberg-questions";
import type { TestConfig } from "./types";
import type { DimensionData } from "@/lib/og-design/types";
import { TEST_COLOR_MAP } from "@/lib/og-design/constants";

// ============================================================================
// Types & Interfaces
// ============================================================================

// 詳細解釈の構造（Phase 5準拠）
export interface DetailedInterpretation {
  summary: string;           // 要約（約200字）
  dailyLifeImpact: string;   // 日常生活への影響（約500字）
  psychBackground: string;   // 心理学的背景（約300字）
  practicalAdvice: string;   // 実用的アドバイス（約500字）
}

export interface RosenbergResult {
  rawScore: number;
  percentageScore: number;
  level: "very_low" | "low" | "medium" | "high" | "very_high";
  interpretation: string;  // 簡潔な解釈（結果サマリー用）
  detailedInterpretation: DetailedInterpretation;  // 詳細解釈（Phase 5準拠）
}

// ============================================================================
// Scoring Logic
// ============================================================================

/**
 * Rosenberg自尊心尺度のスコア計算
 * @param answers 各質問への回答（1-4）
 * @returns 計算結果
 */
export function calculateRosenbergScore(answers: number[]): RosenbergResult {
  if (answers.length !== 10) {
    throw new Error("回答数が正しくありません。10問の回答が必要です。");
  }

  // スコア計算（逆転項目を考慮）
  let rawScore = 0;
  for (let i = 0; i < answers.length; i++) {
    const answer = answers[i];
    const question = rosenbergQuestions[i];

    if (answer < 1 || answer > 4) {
      throw new Error(`無効な回答値: ${answer}. 1-4の範囲で回答してください。`);
    }

    // 逆転項目の場合は反転（1→4, 2→3, 3→2, 4→1）
    const score = question.reverse ? 5 - answer : answer;
    rawScore += score;
  }

  // パーセンテージスコア（10-40を0-100に変換）
  const percentageScore = ((rawScore - 10) / 30) * 100;

  // レベル分類
  let level: RosenbergResult["level"];
  if (rawScore < 15) {
    level = "very_low";
  } else if (rawScore < 20) {
    level = "low";
  } else if (rawScore < 30) {
    level = "medium";
  } else if (rawScore < 35) {
    level = "high";
  } else {
    level = "very_high";
  }

  // 解釈文（簡潔版）
  const interpretation = getInterpretation(level, rawScore, percentageScore);

  // 詳細解釈（Phase 5準拠）
  const detailedInterpretation = getDetailedInterpretation(level, rawScore, percentageScore);

  return {
    rawScore,
    percentageScore: Math.round(percentageScore * 10) / 10,
    level,
    interpretation,
    detailedInterpretation,
  };
}

function getInterpretation(
  level: RosenbergResult["level"],
  rawScore: number,
  percentageScore: number
): string {
  const interpretations = {
    very_low: `自尊心が低い状態です（スコア: ${rawScore}/40, ${percentageScore.toFixed(1)}%）。自分自身に対して否定的な見方をしやすく、自己価値を感じにくい傾向があります。この状態は精神的な健康に影響を与える可能性があるため、専門家に相談することも検討してください。`,
    low: `自尊心がやや低い状態です（スコア: ${rawScore}/40, ${percentageScore.toFixed(1)}%）。自分自身を肯定的に捉えることが難しく、自己評価が低い傾向があります。自己受容を高める取り組みが役立つかもしれません。`,
    medium: `自尊心が平均的な状態です（スコア: ${rawScore}/40, ${percentageScore.toFixed(1)}%）。自分自身に対して概ね肯定的な態度を持っていますが、時には自己評価が揺らぐこともあるでしょう。多くの人がこの範囲に当てはまります。`,
    high: `自尊心が高い状態です（スコア: ${rawScore}/40, ${percentageScore.toFixed(1)}%）。自分自身を肯定的に捉え、自己価値をしっかりと感じています。この自尊心の高さは精神的な健康の基盤となります。`,
    very_high: `自尊心が非常に高い状態です（スコア: ${rawScore}/40, ${percentageScore.toFixed(1)}%）。自分自身に対して非常に肯定的な態度を持ち、強い自己価値感を持っています。この高い自尊心は多くの場面で心の支えとなるでしょう。`,
  };

  return interpretations[level];
}

/**
 * 詳細解釈を取得（Phase 5準拠）
 * 各レベル約1,500字の学術的根拠に基づいた解釈
 */
function getDetailedInterpretation(
  level: RosenbergResult["level"],
  rawScore: number,
  percentageScore: number
): DetailedInterpretation {
  const interpretations: Record<RosenbergResult["level"], DetailedInterpretation> = {
    very_low: {
      summary: `自尊心が著しく低い状態です（スコア: ${rawScore}/40点、${percentageScore.toFixed(1)}%）。自分自身に対して非常に否定的な見方をしており、自己価値を感じることが困難な状態にあります。この状態は精神的健康に深刻な影響を与える可能性があり、日常生活における様々な困難を引き起こしています。専門家への相談を強く推奨します。`,

      dailyLifeImpact: `**対人関係**

低い自尊心は、対人関係において深刻な困難をもたらします。自己疑念が強いため、他者とのコミュニケーションで自分の考えや感情を表現することが非常に難しくなります。「自分の意見には価値がない」という思い込みから、会話の中で沈黙してしまったり、他者の意見に過度に同調してしまったりします。また、他者からの批判に対して極めて敏感になり、些細な否定的フィードバックでも深く傷つき、関係を避けるようになります。親密な関係においては、「自分は愛されるに値しない」という信念から、不安や嫉妬が強まり、相手への過度な依存や、逆に親密さを避けるという両極端な行動パターンが見られます。

**仕事・学業**

職場や学校では、自己疑念が能力発揮の大きな妨げとなります。新しい課題や責任を引き受けることへの強い恐怖感があり、「失敗したら自分の無価値さが証明されてしまう」という思考から、成長の機会を逃してしまいます。会議やプレゼンテーションでは、自分のアイデアを共有することを躊躇し、貢献の機会を見過ごします。また、自己主張が困難なため、給与交渉や昇進の機会を逃し、キャリアの停滞につながることがあります。実際の能力とは無関係に、自己評価が極端に低いため、本来持っている可能性を発揮できずにいます。

**意思決定とストレス対処**

日常的な意思決定においても、自己信頼の欠如が深刻な影響を及ぼします。「自分の判断は間違っている」という前提から、些細な選択（何を食べるか、何を着るか）でさえ過度に悩み、決断を先延ばしにします。重要な人生の決定（転職、引っ越し、人間関係）では、優柔不断が長期化し、機会を逃すことがあります。また、他者の意見に過度に依存し、自分の価値観や長期目標から逸脱した選択をしてしまうことがあります。

ストレス対処においては、低い自尊心が脆弱性を高めます。研究によると、高い自尊心はストレス下でバッファー（緩衝材）として機能しますが、低い自尊心ではこの保護機能が働きません。軽微な挫折でも圧倒的に感じられ、建設的な問題解決ではなく、回避や自己批判といった非適応的な対処法に頼りがちです。`,

      psychBackground: `研究エビデンスは、低い自尊心と精神的健康問題との強い関連を示しています。Sowislo & Orth (2013) のメタ分析により、低い自尊心はうつ病（r = -0.64）および不安症（r = -0.33）と強い負の相関を示すことが確認されています。さらに重要なのは、縦断研究により因果関係の方向性が明らかになっている点です。低い自尊心は、後の時点でのうつ病や不安症の増加を予測しますが、逆方向の効果（うつ・不安が自尊心の低下を予測）は相対的に弱いことが示されています。

Morris Rosenbergの理論によれば、自尊心は「反映された評価」（他者が自分をどう見ているかについての解釈）と「社会的比較」（他者との比較）を通じて形成されます。非常に低い自尊心を持つ人は、他者からのフィードバックを過度に否定的に解釈し、社会的比較において自分を常に劣位に位置づけます。この認知的パターンが、自己評価の悪循環を維持します。`,

      practicalAdvice: `**専門家への相談（最優先）**

このスコア範囲では、**臨床心理士、公認心理師、精神科医などの専門家への相談を強く推奨します**。低い自尊心とうつ病・不安症の強い関連（r = -0.64, -0.33）を考慮すると、専門的な支援が必要な可能性が高いです。以下のような場合は、特に早急な相談が必要です：

- 持続的な気分の落ち込み、興味や喜びの喪失
- 過度な不安や心配が日常生活を妨げている
- 自傷行為や自殺念慮がある場合（緊急の場合は直ちに医療機関へ）
- 社会的引きこもり、学業・仕事の著しい支障

**エビデンスに基づく介入**

研究により効果が実証されている心理療法があります：

1. **認知行動療法（CBT）**: 否定的な自動思考パターンを特定し、より現実的で適応的な思考に置き換える手法です。自尊心の改善に特に有効です。

2. **自己コンパッション療法**: メタ分析により、自己コンパッションベースの介入（マインドフルネス認知療法、コンパッション・フォーカスト・セラピーなど）が、うつ症状（g = 0.40）、不安症状（g = 0.46）、自己コンパッション（g = 0.52）の改善に中程度から大きな効果量を示すことが確認されています。自己批判を和らげ、自分自身に優しく接する方法を学びます。

**日常でできる小さなステップ**

- **否定的自動思考の記録**: 自己批判的な思考が浮かんだ時、それを書き留め、その思考の根拠を客観的に検証する習慣をつけましょう。
- **小さな成功体験の積み重ね**: 達成可能な小さな目標を設定し、それを達成することで自己効力感を少しずつ高めます。
- **信頼できる人への相談**: 1人で抱え込まず、信頼できる家族や友人に自分の状況を共有することも重要です。

**注意点**

- 自尊心の改善には時間がかかります。即座の変化を期待せず、長期的な視点で取り組むことが大切です。
- セルフヘルプだけでは不十分な場合があります。専門家のサポートを受けることは弱さではなく、賢明な選択です。`,
    },

    low: {
      summary: `自尊心が低い状態です（スコア: ${rawScore}/40点、${percentageScore.toFixed(1)}%）。自分自身を肯定的に捉えることが難しく、自己評価が低い傾向があります。日常生活において、自信のなさが様々な場面で影響を及ぼしています。この状態は将来的なメンタルヘルス問題のリスク因子となる可能性があるため、早期の対処が重要です。適切なセルフケアと、必要に応じた専門家のサポートにより、自尊心を高めることができます。`,

      dailyLifeImpact: `**対人関係**

自尊心が低いと、対人関係において複数の課題が生じます。自分の意見や感情を表現することに躊躇し、他者の期待に過度に応えようとする傾向があります。「自分の意見は重要ではない」という思い込みから、グループでの会話で受け身になりがちです。また、批判や拒絶に対して敏感になり、他者からの否定的なフィードバック（実際のものであれ、想像上のものであれ）に過剰に反応します。親密な関係では、「自分は愛されるに値しない」という不安から、パートナーへの過度な reassurance seeking（安心を求める行動）や、嫉妬が生じることがあります。一方で、自分の境界線を適切に設定することが難しく、他者の要求を断れずに疲弊することもあります。

**仕事・学業**

職場や学校では、自己疑念がパフォーマンスに影響します。新しいプロジェクトや責任を引き受けることに不安を感じ、「失敗したらどうしよう」という思考が先行します。実際には能力があるにもかかわらず、自己評価が低いため、挑戦を避け、成長の機会を逃すことがあります。会議やプレゼンテーションでは、自分のアイデアを共有することに躊躇し、貢献の機会を見過ごします。また、昇進や給与交渉において自己主張が弱くなり、キャリアの進展が遅れる可能性があります。Baumeister et al. (2003) の研究によれば、自尊心と仕事のパフォーマンスの因果関係は複雑で、成功が自尊心を高める側面が強いものの、低い自尊心は失敗後の粘り強さを低下させることが示されています。

**意思決定**

日常的な意思決定においても、自己信頼の低さが影響します。「自分の判断は間違っているかもしれない」という不安から、過度に悩み、決断を先延ばしにする傾向があります。重要な決定（転職、引っ越し、人間関係の変化）では、他者の意見に過度に依存し、自分の価値観や長期的な目標から逸脱した選択をしてしまうことがあります。また、完璧主義的な思考（「完璧な選択肢が見つかるまで決めない」）により、優柔不断が長期化することもあります。

**ストレス対処**

ストレス状況では、低い自尊心が脆弱性を高めます。高い自尊心を持つ人はストレスに対するバッファー（緩衝材）機能がありますが、低い自尊心ではこの保護機能が弱いため、ストレッサーの影響を受けやすくなります。軽微な挫折でも自己批判が強まり、「やっぱり自分はダメだ」という思考に陥りがちです。建設的な問題解決よりも、回避や諦めといった非適応的な対処法を選びやすくなります。`,

      psychBackground: `縦断研究により、低い自尊心は将来のメンタルヘルス問題のリスク因子であることが確立されています。Sowislo & Orth (2013) のメタ分析では、低い自尊心が後の時点でのうつ病および不安症の増加を有意に予測することが示されています（β = -.10）。重要なのは、この関係が逆方向よりも強いことです。つまり、うつや不安が自尊心を低下させる効果よりも、低い自尊心がうつや不安を引き起こす効果の方が大きいのです。これは、低い自尊心への早期介入の重要性を示唆しています。

また、低い自尊心は日常生活のストレス経験とも関連しています。研究によれば、自尊心が低い人は、より否定的な感情を経験し、肯定的な感情が少なく、ストレス重症度が高いことが日常生活の測定で確認されています。

Rosenbergの理論的枠組みでは、自尊心は他者からの評価の解釈（反映された評価）と社会的比較を通じて形成されます。低い自尊心を持つ人は、他者のフィードバックを過度に否定的に解釈し、社会的比較で自分を不利に位置づける認知的バイアスを持つ傾向があります。`,

      practicalAdvice: `**専門家への相談を検討**

スコアが15-19点の範囲にある場合、専門家への相談を検討することをお勧めします。特に以下のような症状がある場合は、早めの相談が有益です：

- 気分の落ち込みが2週間以上続いている
- 不安が日常生活に支障をきたしている
- 社会的活動や仕事・学業に明らかな支障がある

**エビデンスに基づく介入方法**

研究により効果が実証されている方法があります：

1. **自己コンパッション（Self-Compassion）の実践**: メタ分析により、自己コンパッションベースの介入が、うつ症状（g = 0.40）、不安症状（g = 0.46）、自己コンパッション（g = 0.52）の改善に中程度から大きな効果量を示すことが確認されています。自己批判を和らげ、自分自身に優しく接することを学びます。
   - **実践例**: 困難な状況に直面したとき、「自分はダメだ」という自己批判ではなく、「誰でも困難を経験する。今は辛いけれど、自分を責める必要はない」と自分に語りかけます。

2. **認知行動療法（CBT）的アプローチ**: 否定的な自動思考を特定し、より現実的でバランスの取れた思考に置き換える方法です。
   - **実践例**: 「自分には価値がない」という思考が浮かんだら、その根拠を検証し、反証（「過去に成功した経験」「他者から感謝されたこと」など）を探します。

3. **マインドフルネス瞑想**: 自己批判的な思考に巻き込まれず、現在の瞬間に注意を向ける訓練です。研究により、マインドフルネスの実践が自己コンパッションを高め、うつや不安の症状を軽減することが示されています。

**日常でできる小さなステップ**

- **強みの再発見**: 自分の強みや過去の成功体験をリストアップし、定期的に振り返ります。
- **小さな達成目標の設定**: 達成可能な小さな目標を設定し、それを達成することで自己効力感を徐々に高めます。
- **ポジティブなフィードバックの記録**: 他者からの肯定的なフィードバックを日記に記録し、自己批判が強まったときに読み返します。
- **自己比較ではなく、過去の自分との比較**: 他者と比較するのではなく、「過去の自分と比べてどう成長したか」に焦点を当てます。

**注意点**

- 自尊心の改善には時間がかかります。一朝一夕の変化を期待せず、継続的な取り組みが大切です。
- 完璧主義を手放すことも重要です。「完璧でなければ価値がない」という思考は、自尊心をさらに低下させます。`,
    },

    medium: {
      summary: `自尊心が平均的な状態です（スコア: ${rawScore}/40点、${percentageScore.toFixed(1)}%）。自分自身に対して概ね肯定的な態度を持っていますが、状況によっては自己評価が揺らぐこともあります。多くの人がこの範囲に当てはまり、正常な範囲と考えられます。現在の自尊心を維持しながら、さらに高めていく余地もあります。適切なセルフケアと自己理解を深めることで、より安定した自己価値感を育むことができます。`,

      dailyLifeImpact: `**対人関係**

平均的な自尊心を持つ人は、対人関係において比較的バランスの取れた態度を示します。自分の意見を表現することもできますが、他者の意見も尊重します。ただし、状況によっては自信が揺らぐことがあります。例えば、権威的な人物や専門家の前では、自分の意見を控えめに表現したり、批判を受けたときには一時的に自己疑念が強まったりすることがあります。親密な関係では、概ね健全なコミュニケーションが取れますが、ストレスの多い時期や葛藤が生じたときには、不安や自己疑念が表面化することがあります。多くの場合、時間の経過とともに自己評価は安定化します。

**仕事・学業**

職場や学校では、適度な自信を持って課題に取り組むことができます。新しい挑戦に対しても、過度な不安を感じることなく取り組めることが多いですが、非常に高い難易度のタスクや、過去に失敗した経験がある分野では、自信が揺らぐことがあります。Baumeister et al. (2003) の研究によれば、自尊心と学業成績の関係は複雑で、必ずしも高い自尊心が高い成績を直接引き起こすわけではありません。むしろ、成功体験が自尊心を高める側面が強いです。ただし、平均的な自尊心を持つ人は、失敗後も適度に粘り強く取り組むことができる傾向があります。

キャリアにおいては、昇進や新しい役割への挑戦において、適度な自信と慎重さのバランスを取ります。自己主張が必要な場面（給与交渉、自分の貢献のアピールなど）では、やや躊躇することがあるかもしれませんが、完全に避けるわけではありません。

**意思決定**

日常的な意思決定は概ねスムーズに行えます。重要な決定においては、適度に情報を収集し、自分の判断を信頼しつつも、他者の意見も参考にするバランスの取れたアプローチを取ります。ただし、非常に重要な人生の決定（キャリアの大きな転換、人間関係の重要な変化など）では、自己疑念が強まり、決断に時間がかかることがあります。完璧主義的な傾向が強い場合、「最善の選択」を求めて優柔不断になることもあります。

**ストレス対処**

ストレス状況に対する対処は、概ね適応的です。軽度から中程度のストレッサーには、問題解決的なアプローチを取ることができます。ただし、非常に強いストレスや長期的なストレス（失業、重要な喪失、健康問題など）に直面すると、自己評価が一時的に低下し、対処能力が弱まることがあります。研究によれば、高い自尊心はストレスに対するバッファー（緩衝材）として機能しますが、平均的な自尊心ではこの保護機能が部分的にしか働かない可能性があります。`,

      psychBackground: `平均的な自尊心（20-29点）は、人口の大多数が該当する正常範囲です。統計的には、ローゼンバーグ自尊心尺度のスコア分布において、平均値は約20-25点、標準偏差は5-6点程度とされており、このスコア範囲は平均付近からやや上に位置します。

重要な点として、自尊心は完全に安定した特性ではなく、状況や時間経過によって変動する側面を持ちます。Steyer et al. (1999) の Trait-State-Outcome モデルによれば、自尊心は特性的要素（比較的安定した個人差）と状態的要素（状況による変動）の両方を含みます。平均的な自尊心を持つ人は、ポジティブな出来事や成功体験により自尊心が一時的に高まり、ネガティブな出来事や失敗により一時的に低下するという変動を経験します。

また、文化的要因も重要です。日本の研究によれば、青年期は自尊心が低い傾向があり、成人期以降に徐々に上昇していくことが示されています。特に日本文化では、謙虚さが重視されるため、欧米と比較して自尊心スコアがやや低めに出る傾向があることが知られています。したがって、文化的文脈を考慮すると、日本人においてこのスコア範囲は十分に健康的であると言えます。`,

      practicalAdvice: `**現在の自尊心を維持する**

平均的な自尊心は健康的な範囲にありますが、さらに向上させる余地もあります。以下の方法で、現在の状態を維持しつつ、さらに高めることができます。

**自尊心をさらに高める方法**

1. **自己コンパッションの実践**: 研究により、自己コンパッション（自分自身に優しく接すること）が自尊心よりも優れた予測因子であることが示されています。自己批判が強まったとき、「誰でも失敗する。自分を責めるのではなく、学びの機会にしよう」と語りかけます。

2. **強みに基づく活動**: VIA Character Strengths（価値観・強み）の研究によれば、自分の強みを認識し、それを日常生活で活用することが、自尊心とウェルビーイングを高めます。自分の強み（例: 創造性、親切心、リーダーシップ、学習意欲など）を特定し、それを活かせる活動を増やします。

3. **マインドフルネス実践**: マインドフルネス瞑想は、自己批判的な思考パターンに気づき、それに巻き込まれない力を養います。1日5-10分の短い瞑想でも、継続することで効果が得られます。

4. **成長マインドセット**: 自分の能力は固定的ではなく、努力により成長できると考えることで、失敗を脅威ではなく学習の機会と捉えられるようになります。

**日常でできる小さなステップ**

- **感謝日記**: 毎日、その日に起こった良いことや感謝できることを3つ書き出します。これにより、ポジティブな側面に注意を向ける習慣が育ちます。
- **小さな挑戦**: 快適ゾーン（comfort zone）を少しだけ広げる小さな挑戦を定期的に行います。これにより、自己効力感が高まります。
- **ソーシャルサポートの活用**: 信頼できる友人や家族との良好な関係を維持します。研究により、ソーシャルサポートは自尊心とメンタルヘルスの保護因子であることが示されています。

**将来のリスクへの予防**

平均的な自尊心を持つ人でも、強いストレス（失業、喪失、健康問題など）により自尊心が一時的に低下することがあります。以下の予防的対策が有効です：

- **ストレス管理スキル**: 問題解決スキル、リラクゼーション技法、時間管理などを学び、ストレス耐性を高めます。
- **早期のセルフケア**: 自尊心が低下し始めたら、早めに対処します（専門家への相談、セルフヘルプ資源の活用など）。

**注意点**

- 自尊心を高めることと、自己中心的になることは別です。他者への配慮とバランスを取りながら、健全な自己価値感を育てることが大切です。
- 過度に高い自尊心（narcissistic self-esteem）は、対人関係の問題や現実検討能力の低下につながることがあります。適度でバランスの取れた自尊心が理想的です。`,
    },

    high: {
      summary: `自尊心が高い状態です（スコア: ${rawScore}/40点、${percentageScore.toFixed(1)}%）。自分自身を肯定的に捉え、自己価値をしっかりと感じています。この高い自尊心は精神的健康の重要な基盤となり、ストレスに対する保護因子として機能します。対人関係や仕事・学業において、適切な自信を持って取り組むことができ、困難な状況にも粘り強く対処できます。この状態を維持し、さらに健全な方向で発展させていくことが大切です。`,

      dailyLifeImpact: `**対人関係**

高い自尊心を持つ人は、対人関係において自信を持って振る舞います。自分の意見や感情を適切に表現でき、他者との境界線を健全に設定することができます。批判やネガティブなフィードバックを受けても、それを建設的に受け止め、自己価値感が大きく揺らぐことはありません。親密な関係においては、「自分は愛されるに値する」という感覚があるため、過度な不安や嫉妬に悩まされることが少なく、安定した関係を築くことができます。

ただし、Baumeister et al. (2003) の研究によれば、高い自尊心を持つ人が「自分はより好かれ、魅力的で、良い関係を持っている」と主観的に報告する一方、客観的な測定ではこれらの信念の多くが確認されないことが示されています。つまり、高い自尊心は主観的な対人関係満足度を高めますが、客観的な関係の質を必ずしも保証するわけではありません。自分の主観的評価と他者の視点のバランスを取ることが重要です。

**仕事・学業**

職場や学校では、高い自尊心が適切な自信として表れます。新しいプロジェクトや責任を引き受けることに前向きで、挑戦を成長の機会と捉えます。会議やプレゼンテーションでは、自分のアイデアを効果的に伝え、貢献することができます。昇進や給与交渉においても、適切に自己主張ができます。

重要な点として、Baumeister et al. (2003) の研究では、高い自尊心が直接的に優れた仕事のパフォーマンスを引き起こすという証拠は限定的であることが示されています。むしろ、成功体験が自尊心を高める側面が強いです。ただし、高い自尊心の重要な利点として、**失敗後の粘り強さを促進する**ことが実験的に確認されています。つまり、高い自尊心を持つ人は、挫折してもすぐに諦めず、再挑戦する傾向があります。この粘り強さが、長期的にはキャリアの成功につながります。

**意思決定**

日常的な意思決定から重要な人生の決定まで、高い自己信頼に基づいて判断を下すことができます。必要な情報を収集しつつ、最終的には自分の判断を信頼します。他者の意見も参考にしますが、過度に依存することはありません。自分の価値観や長期的な目標に沿った選択をする傾向があります。

**ストレス対処**

高い自尊心の最も重要な機能の一つは、**ストレスに対するバッファー（緩衝材）効果**です。研究により、高い自尊心はストレスの有害な影響を軽減し、メンタルヘルスを保護することが示されています。困難な状況に直面しても、「自分には対処する力がある」という信念があるため、問題解決的なアプローチを取ることができます。一時的な挫折を経験しても、自己価値感が根本的に揺らぐことは少なく、比較的早く回復します。`,

      psychBackground: `高い自尊心（30-34点）は、メンタルヘルスの重要な保護因子です。Sowislo & Orth (2013) のメタ分析により、自尊心とうつ病（r = -0.64）および不安症（r = -0.33）の間に強い負の相関があることが確認されています。縦断研究では、高い自尊心が将来のメンタルヘルス問題のリスクを低減することが示されています。

また、高い自尊心はストレスに対する保護機能を持ちます。ストレッサーに直面したとき、高い自尊心を持つ人は、自己価値感が脅かされにくく、適応的な対処戦略（問題解決、社会的サポートの活用など）を選択しやすくなります。

ただし、Baumeister et al. (2003) の重要な知見として、高い自尊心が必ずしも客観的な成功（学業成績、仕事のパフォーマンス、対人関係の質）を直接引き起こすわけではないことが示されています。むしろ、成功体験が自尊心を高める側面が強いです。しかし、高い自尊心の明確な利点として、**失敗後の粘り強さを促進する**ことが実験的に確認されています。この粘り強さが、長期的には成功の可能性を高めます。`,

      practicalAdvice: `**現在の自尊心を維持する**

高い自尊心は貴重な心理的資源です。以下の方法で、この状態を維持し、さらに健全な方向で発展させることができます。

**健全な自尊心を保つための実践**

1. **現実的な自己評価のバランス**: 自分の強みを認識しつつ、改善の余地がある領域も受け入れます。過度な自己評価（narcissistic self-esteem）は、対人関係の問題や現実検討能力の低下につながることがあります。

2. **自己コンパッションの統合**: 研究により、自己コンパッションは自尊心よりも安定した well-being の予測因子であることが示されています。自己コンパッションは、失敗や困難な状況でも自己価値感を維持する力を与えます。「自分に優しくする」実践を取り入れましょう。

3. **成長マインドセット**: 自分の能力は固定的ではなく、努力により成長できると考えることで、失敗を脅威ではなく学習の機会と捉えられます。これにより、自尊心が成功体験だけに依存しなくなります。

**他者への配慮とバランス**

高い自尊心を持つ人は、時として自己中心的になるリスクがあります。以下の点に注意しましょう：

- **謙虚さの維持**: 自分の成功を認識しつつ、他者の貢献や運の要素も認めます。特に日本文化では謙虚さが重視されるため、文化的文脈に配慮した自己表現が重要です。
- **他者の視点の尊重**: 自分の意見に自信を持ちつつ、他者の視点や専門知識も尊重します。
- **共感と思いやり**: 自尊心が低い人の困難を理解し、サポートすることも大切です。

**継続的な自己成長**

- **新しい挑戦**: 快適ゾーン（comfort zone）を広げる新しい挑戦を続けることで、自己効力感と自尊心がさらに高まります。
- **強みの活用**: 自分の強み（VIA Character Strengths など）を認識し、それを日常生活や仕事で活用します。
- **意義ある目標**: 自分の価値観に沿った意義ある目標を設定し、それに向かって取り組むことで、自尊心がさらに安定します。

**ストレス管理**

高い自尊心はストレスバッファーとして機能しますが、非常に強いストレス（喪失、健康問題、長期的な困難）では、誰でも影響を受けます。以下の予防的対策が有効です：

- **ソーシャルサポート**: 信頼できる人間関係を維持し、困難な時には助けを求めることを厭いません。
- **セルフケアの継続**: 規則正しい生活、適度な運動、十分な睡眠、リラクゼーションなどの基本的なセルフケアを継続します。

**注意点**

- 高い自尊心を維持することと、傲慢になることは別です。他者への敬意とバランスを保ちながら、健全な自己価値感を育てることが大切です。
- 自尊心が外的な成功（地位、評価、業績）にのみ依存すると、それらを失ったときに自尊心が崩れるリスクがあります。内的な自己価値感（自分の存在そのものの価値）を育てることも重要です。`,
    },

    very_high: {
      summary: `自尊心が非常に高い状態です（スコア: ${rawScore}/40点、${percentageScore.toFixed(1)}%）。自分自身に対して非常に肯定的な態度を持ち、強い自己価値感を持っています。この高い自尊心は多くの場面で心の支えとなり、主観的幸福感や人生満足度と強く関連しています。ただし、客観的な成功との因果関係は限定的であることを理解し、謙虚さとバランスを保つことが重要です。他者への配慮を忘れず、健全な形で自尊心を維持していくことが大切です。`,

      dailyLifeImpact: `**対人関係**

非常に高い自尊心を持つ人は、対人関係において強い自信を示します。自分の意見や感情を明確に表現し、他者との境界線を効果的に設定します。批判やネガティブなフィードバックに対しても、自己価値感が揺らぐことはほとんどありません。

ただし、Baumeister et al. (2003) の重要な研究知見によれば、高い自尊心を持つ人は**主観的には**「自分はより好かれ、魅力的で、より良い関係を持ち、他者により良い印象を与えている」と報告しますが、**客観的測定ではこれらの信念のほとんどが確認されません**。つまり、自己評価と他者の評価の間にギャップが存在する可能性があります。また、自尊心は関係の質や持続期間を予測することが示されていません。

このため、非常に高い自尊心を持つ人は、以下の点に注意が必要です：
- **他者の視点の尊重**: 自分の主観的評価が必ずしも客観的現実と一致しないことを認識します。
- **フィードバックの受容**: 他者からの建設的なフィードバックを防衛的にならずに受け入れます。
- **共感と思いやり**: 自分の自信が、他者を萎縮させたり、自尊心の低い人を傷つけたりしないように配慮します。

**仕事・学業**

職場や学校では、非常に高い自信を持って課題に取り組みます。新しい挑戦を積極的に引き受け、リーダーシップを発揮することが多いです。困難な状況でも、「自分には乗り越える力がある」という強い信念があります。

Baumeister et al. (2003) の研究では、自尊心と仕事のパフォーマンスの関係は複雑であることが示されています。高い自尊心が直接的に優れたパフォーマンスを引き起こすという証拠は限定的で、むしろ**成功体験が自尊心を高める**側面が強いです。つまり、職業的成功が自尊心を高めるのであって、その逆の因果関係は弱いということです。

ただし、高い自尊心の明確な利点として、**失敗後の粘り強さを促進する**ことが実験的に確認されています。非常に高い自尊心を持つ人は、挫折してもすぐに立ち直り、再挑戦する傾向があります。この粘り強さが、長期的にはキャリアの成功に寄与します。

**意思決定**

強い自己信頼に基づいて、迅速かつ自信を持って決定を下すことができます。他者の意見を参考にしつつも、最終的には自分の判断を信頼します。優柔不断になることは稀です。

ただし、過度な自信が時として、十分な情報収集や慎重な検討を欠いた性急な決定につながるリスクもあります。複雑で不確実性の高い状況では、適度な慎重さも必要です。

**ストレス対処と主観的幸福感**

非常に高い自尊心の最も重要な利点は、**主観的幸福感との強い関連**です。研究により、自尊心は学業成功、人生満足度、関係満足度、ポジティブな身体イメージ、全般的ウェルビーイングと正の関連を持つことが示されています。

ストレス状況においても、強い自己価値感がバッファーとして機能し、困難に対する耐性が高いです。「自分には対処する力がある」という信念があるため、問題解決的なアプローチを取り、建設的に行動できます。`,

      psychBackground: `非常に高い自尊心（35-40点）は、主観的幸福感とメンタルヘルスの重要な予測因子です。Sowislo & Orth (2013) のメタ分析により、自尊心とうつ病（r = -0.64）および不安症（r = -0.33）の間に強い負の相関があることが確認されています。非常に高い自尊心を持つ人は、これらのメンタルヘルス問題のリスクが著しく低いと考えられます。

ただし、Baumeister et al. (2003) の包括的レビューは、高い自尊心の効果について重要な知見を提供しています：

1. **主観的評価と客観的現実のギャップ**: 高い自尊心を持つ人は、対人的成功、魅力、能力について高く自己評価しますが、客観的測定ではこれらの信念の多くが確認されません。

2. **因果関係の方向性**: 高い自尊心がパフォーマンス（学業、仕事）を向上させるというより、成功体験が自尊心を高める側面が強いです。

3. **失敗後の粘り強さ**: 重要な例外として、高い自尊心は失敗後の粘り強さを促進することが実験的に確認されています。

日本文化の文脈では、非常に高い自尊心（35-40点）は欧米基準と比較すると相対的に高いです。日本の研究によれば、文化的に謙虚さが重視されるため、平均的な自尊心スコアは欧米よりやや低い傾向があります。したがって、日本においてこのスコア範囲は非常にポジティブな自己評価を示します。`,

      practicalAdvice: `**健全な自尊心のバランスを保つ**

非常に高い自尊心は貴重な心理的資源ですが、以下の点に注意して、健全でバランスの取れた形で維持することが大切です。

**謙虚さと現実的自己評価**

1. **主観的評価と客観的現実の区別**: 自分の主観的評価（「自分は優れている」）と客観的現実（他者の評価、実際のパフォーマンス）が必ずしも一致しないことを認識します。定期的に他者からのフィードバックを求め、自己認識を調整します。

2. **成長マインドセット**: 「すでに完璧である」という思考ではなく、「まだ成長できる」という姿勢を保ちます。これにより、学習機会を逃さず、傲慢さを避けられます。

3. **文化的配慮**: 特に日本文化では謙虚さが重視されます。自分の成功を認識しつつ、他者の貢献や運の要素も認め、謙虚に振る舞うことで、対人関係がより円滑になります。

**自己コンパッションの統合**

研究により、自己コンパッション（self-compassion）は自尊心よりも安定したウェルビーイングの予測因子であることが示されています。自尊心は外的成功や社会的比較に依存しやすいのに対し、自己コンパッションは失敗や困難な状況でも自己価値感を維持する力を与えます。

- **失敗への対処**: 失敗したとき、自尊心だけに依存すると「失敗 = 自分の価値の低下」と感じるリスクがあります。自己コンパッションを実践し、「誰でも失敗する。これは学びの機会だ」と自分に語りかけます。

**他者への配慮**

1. **共感と思いやり**: 自尊心が低い人や困難を抱えている人に対して、共感的に接します。自分の高い自尊心が、他者を萎縮させたり、劣等感を感じさせたりしないように配慮します。

2. **他者の視点の尊重**: 自分の意見に自信を持ちつつ、他者の視点や専門知識も真摯に尊重します。

3. **協力と貢献**: 自分の強みを自己満足のためだけに使うのではなく、他者や社会への貢献に活かします。

**継続的な自己成長**

- **新しい挑戦**: 既に得意な分野だけでなく、未知の領域にも挑戦し、自己効力感をさらに広げます。
- **意義ある目標**: 自分の価値観に沿った意義ある目標を設定し、それに向かって取り組むことで、自尊心がさらに安定します。
- **学びと反省**: 定期的に自己反省を行い、改善の余地がある領域を特定します。

**ストレス管理とセルフケア**

非常に高い自尊心はストレスバッファーとして機能しますが、過信は禁物です：

- **過労の回避**: 「自分はなんでもできる」という過信から、過度な仕事量を引き受けないように注意します。
- **セルフケアの継続**: 規則正しい生活、適度な運動、十分な睡眠、リラクゼーションなどの基本的なセルフケアを継続します。
- **ソーシャルサポート**: 困難な時には助けを求めることを厭わず、信頼できる人間関係を維持します。

**注意点**

- **傲慢さの回避**: 非常に高い自尊心が傲慢さ（narcissism）に転じると、対人関係の問題や現実検討能力の低下につながります。謙虚さとバランスを保つことが重要です。
- **外的成功への依存の回避**: 自尊心が外的な成功（地位、評価、業績）にのみ依存すると、それらを失ったときに自尊心が崩れるリスクがあります。内的な自己価値感（自分の存在そのものの価値）を育てることも重要です。`,
    },
  };

  return interpretations[level];
}

/**
 * スコアの信頼性チェック
 * すべて同じ回答（例: 全て3）の場合は警告
 */
export function validateAnswerPattern(answers: number[]): {
  valid: boolean;
  warning?: string;
} {
  const uniqueAnswers = new Set(answers);

  if (uniqueAnswers.size === 1) {
    return {
      valid: false,
      warning:
        "すべて同じ回答が選択されています。正確な結果を得るため、各質問を注意深くお読みください。",
    };
  }

  if (uniqueAnswers.size === 2 && answers.length === 10) {
    return {
      valid: true,
      warning:
        "回答パターンが単調です。より正確な結果を得るため、各質問に対して率直に答えることをお勧めします。",
    };
  }

  return { valid: true };
}

// ============================================================================
// Test Configuration
// ============================================================================

/**
 * RSES (Rosenberg Self-Esteem Scale) テスト設定
 */
export const rosenbergConfig: TestConfig<RosenbergResult> = {
  id: "rosenberg",
  color: "pink",
  basePath: "/rosenberg",
  questions: rosenbergQuestions,
  scaleOptions,
  calculateScore: calculateRosenbergScore,
  validateAnswers: validateAnswerPattern,
  scaleInfo,

  // 結果ページ設定
  scoreDisplay: {
    type: "circle",
    maxScore: 40,
  },
  resultExtensions: {
    shareButtons: true,
  },

  // OG画像設定
  ogImage: {
    layoutType: "single",
    titleEn: "SELF\nESTEEM",
    category: "自尊心診断",
    description: "Rosenberg自尊心尺度\n学術的に信頼された自己評価",
    scoreDisplay: { type: "raw", min: 10, max: 40, unit: "" },
    scoreToParams: (result: RosenbergResult) => ({
      score: (result?.rawScore ?? 25).toString(),
    }),
    paramsToScore: (params: URLSearchParams) => ({
      score: parseInt(params.get("score") || "25"),
    }),
  },

  // 🆕 NEW: 1次元データ生成
  getDimensions: (result: RosenbergResult): DimensionData[] => {
    const min = 10;
    const max = 40;
    const rawScore = result?.rawScore ?? 25;
    const percentage = result?.percentageScore ?? ((rawScore - min) / (max - min)) * 100;

    return [{
      key: 'score',
      label: 'Total Score',
      score: rawScore,
      percentage: percentage,
      color: TEST_COLOR_MAP['pink'] || '#ec4899',
    }];
  },
};
